) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
) %>%
View()
tibble(
end_dates = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_dates = end_dates - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
) %>%
mutate(
mean_window = mean(price.close[ref.date >= start_dates & ref.date <= end_dates],
na.rm = T
)
)
tibble(
end_dates = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_dates = end_dates - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
) %>%
mutate(
mean_window = mean(price.close[ref.date >= start_dates & ref.date <= end_dates],
na.rm = T
)
) %>%
View()
tibble(
end_dates = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_dates = end_dates - .window_length_days + 1,
) %>%
# mutate(
#   id = row_number()
# ) %>%
full_join(.df #%>%
# mutate(
#   id = row_number()
# )
,
by = row_number() #'id'
)
tibble(
end_dates = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_dates = end_dates - .window_length_days + 1,
) %>%
# mutate(
#   id = row_number()
# ) %>%
full_join(.df #%>%
# mutate(
#   id = row_number()
# )
,
by = row_number #'id'
)
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_dates - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
) %>%
mutate(
mean_window = mean(price.close[ref.date >= start_date & ref.date <= end_date],
na.rm = T
)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_dates - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
)
.df <- as_tibble(l.out$df.tickers)
.window_length_days <- 7
latest_end_date <- .df %>%
summarize(start_date = max(ref.date, na.rm = TRUE)) %>%
pull()
earliest_end_date <- .df %>%
summarize(start_date = min(ref.date, na.rm = TRUE)) %>%
pull() +
.window_length_days - 1
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_dates - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
) %>%
mutate(
mean_window = mean(price.close[ref.date >= start_date & ref.date <= end_date],
na.rm = T
)
)
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_dates - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
)
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_dates - .window_length_days + 1,
) %>%
mutate(
id = row_number()
)
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
)
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
) %>%
mutate(
mean_window = mean(price.close[ref.date >= start_date & ref.date <= end_date],
na.rm = T
)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(
id = row_number()
) %>%
full_join(.df %>%
mutate(
id = row_number()
)
,
by = 'id'
) %>%
mutate(
window_mean = mean(
price.close, #[ref.date >= start_date & ref.date <= end_date],
na.rm = T
)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(id = row_number()) %>%
full_join(.df %>%
mutate(id = row_number()),
by = 'id') %>%
mutate(window_mean = ref.date >= start_date & ref.date <= end_date #mean(price.close, #[ref.date >= start_date & ref.date <= end_date],
#  na.rm = T)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(id = row_number()) %>%
full_join(.df %>%
mutate(id = row_number()),
by = 'id') %>%
rowwise() %>%
mutate(window_mean = ref.date >= start_date & ref.date <= end_date #mean(price.close, #[ref.date >= start_date & ref.date <= end_date],
#  na.rm = T)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(id = row_number()) %>%
full_join(.df %>%
mutate(id = row_number()),
by = 'id') %>%
rowwise() %>%
mutate(window_mean = ref.date >= start_date && ref.date <= end_date #mean(price.close, #[ref.date >= start_date & ref.date <= end_date],
#  na.rm = T)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(id = row_number()) %>%
full_join(.df %>%
mutate(id = row_number()),
by = 'id') %>%
rowwise() %>%
mutate(window_mean = mean(price.close[ref.date >= start_date && ref.date <= end_date],
na.rm = T)
) %>%
View()
.window_length_days <- 2
latest_end_date <- .df %>%
summarize(start_date = max(ref.date, na.rm = TRUE)) %>%
pull()
earliest_end_date <- .df %>%
summarize(start_date = min(ref.date, na.rm = TRUE)) %>%
pull() +
.window_length_days - 1
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(id = row_number()) %>%
full_join(.df %>%
mutate(id = row_number()),
by = 'id') %>%
rowwise() %>%
mutate(window_mean = mean(price.close[ref.date >= start_date && ref.date <= end_date],
na.rm = T)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(id = row_number()) %>%
full_join(.df %>%
mutate(id = row_number()),
by = 'id') %>%
mutate(window_mean = mean(price.close[ref.date >= start_date && ref.date <= end_date],
na.rm = T)
) %>%
View()
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
) %>%
mutate(id = row_number()) %>%
full_join(.df %>%
mutate(id = row_number()),
by = 'id') %>%
tidyr::expand(
start_date, ref.date
)
tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
)
dates <- tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_length_days + 1,
)
dates[1]
dates[1,]
.dates <- dates[1,]
stopifnot(nrow(.dates)==1)
.df
.df %>%
filter(ref.date >= .dates$start_date && ref.date <= .dates$end_date) %>%
pull(price.close)
mean(
.df %>%
filter(ref.date >= .dates$start_date && ref.date <= .dates$end_date) %>%
pull(price.close)
)
.dates %>%
mutate(
window_mean = mean(
.df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
)
)
.dates <- dates[1,]
stopifnot(nrow(.dates)==1)
.df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
.df %>%
filter(ref.date >= .dates$start_date && ref.date <= .dates$end_date) %>%
pull(price.close)
.df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
.window_length_days
res <- .dates %>%
mutate(
window_mean = mean(
.df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
)
)
res
prices_in_window <- .df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
prices_in_window
res <- .dates %>%
mutate(
window_mean = mean(prices_in_window, na.rm = T),
window_sd = sd(prices_in_window, na.rm = T)
)
res
.df
.dates
res
(end_date - start_date)
.dates %>%
mutate(
mid_date = start_date + (end_date - start_date)/2,
window_mean = mean(prices_in_window, na.rm = T),
window_sd = sd(prices_in_window, na.rm = T)
)
.df <- as_tibble(l.out$df.tickers)
.window_size_days <- 10
latest_end_date <- .df %>%
summarize(start_date = max(ref.date, na.rm = TRUE)) %>%
pull()
earliest_end_date <- .df %>%
summarize(start_date = min(ref.date, na.rm = TRUE)) %>%
pull() +
.window_size_days - 1
dates <- tibble(
end_date = earliest_end_date + 0:(latest_end_date - earliest_end_date),
start_date = end_date - .window_size_days + 1,
)
.dates <- dates[1,]
stopifnot(nrow(.dates)==1)
prices_in_window <- .df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
.dates %>%
mutate(
mid_date = start_date + (end_date - start_date)/2,
window_mean = mean(prices_in_window, na.rm = T),
window_sd = sd(prices_in_window, na.rm = T),
window_size_days = .window_size_days
)
window_summaries <- function(.dates, .df, .window_size_days){
stopifnot(nrow(.dates)==1)
prices_in_window <- .df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
.dates %>%
mutate(
mid_date = start_date + (end_date - start_date)/2,
window_mean = mean(prices_in_window, na.rm = T),
window_sd = sd(prices_in_window, na.rm = T),
window_size_days = .window_size_days
)
}
.dates
window_summaries(.dates, .df, .window_size_days = 20)
window_summaries <- function(.dates, .df, .window_size_days){
stopifnot(nrow(.dates)==1)
prices_in_window <- .df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
.dates %>%
transmute(
window_end_date = end_date,
window_start_date = start_date,
mid_date = start_date + (end_date - start_date)/2,
window_mean = mean(prices_in_window, na.rm = T),
window_sd = sd(prices_in_window, na.rm = T),
window_size_days = .window_size_days
)
}
window_summaries(.dates, .df, .window_size_days = 20)
window_summaries <- function(.dates, .df, .window_size_days){
stopifnot(nrow(.dates)==1)
prices_in_window <- .df %>%
filter(ref.date >= .dates$start_date & ref.date <= .dates$end_date) %>%
pull(price.close)
.dates %>%
transmute(
window_end_date = end_date,
window_start_date = start_date,
window_mid_date = start_date + (end_date - start_date)/2,
window_mean = mean(prices_in_window, na.rm = T),
window_sd = sd(prices_in_window, na.rm = T),
window_size_days = .window_size_days
)
}
window_summaries(.dates, .df, .window_size_days = 20)
dates[1,]
map(dates[1,], window_summaries(.df, .window_size_days = 15))
purrr::map(dates[1,], window_summaries(.df, .window_size_days = 15))
dates[1,]
purrr::map(dates[1,], window_summaries, .df = .df, .window_size_days = 15)
?map
library(BatchGetSymbols)
first.date <- Sys.Date() - 60
last.date <- Sys.Date()
freq.data <- 'daily'
#tickers <- c('FB', 'MMM', 'PETR4.SA', 'abcdef')
tickers <- c('PLUG' )#, 'BLDP')
l.out <- BatchGetSymbols(tickers = tickers,
first.date = first.date,
last.date = last.date,
freq.data = freq.data)
l.out
#install.packages("BatchGetSymbols", dependencies = T)
library(BatchGetSymbols)
first.date <- Sys.Date() - 60
last.date <- Sys.Date()
freq.data <- 'daily'
#tickers <- c('FB', 'MMM', 'PETR4.SA', 'abcdef')
tickers <- c('PLUG', 'BLDP')
l.out <- BatchGetSymbols(tickers = tickers,
first.date = first.date,
last.date = last.date,
freq.data = freq.data)
#cache.folder = file.path(tempdir(), 'BGS_Cache')
#View(l.out$df.tickers)
d.stocks <- l.out$df.tickers
d.stocks
source("data_preparation.R")
ggplot(d.stocks, aes(x = ref.date, y = price.adjusted)) +
geom_line()
library(ggplot2)
ggplot(d.stocks, aes(x = ref.date, y = price.adjusted)) +
geom_line()
ggplot(d.stocks, aes(x = ref.date, y = price.adjusted)) +
geom_line() +
facet_wrap(ticker)
?facet_wrap
ggplot(d.stocks, aes(x = ref.date, y = price.adjusted)) +
geom_line() +
facet_wrap(vars(ticker))
source("data_preparation.R")
library(ggplot2)
ggplot(d.stocks, aes(x = ref.date, y = price.adjusted)) +
geom_line() +
facet_wrap(vars(ticker))
ggplot(d.stocks, aes(x = ref.date, y = price.adjusted)) +
geom_line() +
facet_wrap(vars(ticker)) +
theme_light()
rmarkdown::render("stocks_report.R")
rmarkdown::render("stocks_report.R")
rmarkdown::render("stocks_report.R")
rmarkdown::render("stocks_report.R")
